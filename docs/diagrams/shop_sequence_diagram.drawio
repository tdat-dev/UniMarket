<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.2.9 Chrome/140.0.7339.249 Electron/38.7.2 Safari/537.36" version="29.2.9" pages="1">
  <diagram name="Cửa hàng Shop" id="shop-seq">
    <mxGraphModel dx="1892" dy="1212" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- ========== LIFELINES ========== -->
        <mxCell id="user-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="110" y="80" as="sourcePoint" />
            <mxPoint x="110" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="view-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="260" y="80" as="sourcePoint" />
            <mxPoint x="260" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ctrl-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="440" y="80" as="sourcePoint" />
            <mxPoint x="440" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="user-model-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="620" y="80" as="sourcePoint" />
            <mxPoint x="620" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="product-model-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="780" y="80" as="sourcePoint" />
            <mxPoint x="780" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="follow-model-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="940" y="80" as="sourcePoint" />
            <mxPoint x="940" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="order-model-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="1100" y="80" as="sourcePoint" />
            <mxPoint x="1100" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=1 4;strokeWidth=1;rounded=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="1260" y="80" as="sourcePoint" />
            <mxPoint x="1260" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- ========== PARTICIPANT BOXES ========== -->
        <mxCell id="user-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;C : User&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="100" x="60" y="30" as="geometry" />
        </mxCell>
        <mxCell id="view-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;A : View&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="100" x="210" y="30" as="geometry" />
        </mxCell>
        <mxCell id="ctrl-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;Controller : ShopController&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="120" x="380" y="30" as="geometry" />
        </mxCell>
        <mxCell id="user-model-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;Model : User&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="100" x="570" y="30" as="geometry" />
        </mxCell>
        <mxCell id="product-model-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;Model : Product&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="100" x="730" y="30" as="geometry" />
        </mxCell>
        <mxCell id="follow-model-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;Model : Follow&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="100" x="890" y="30" as="geometry" />
        </mxCell>
        <mxCell id="order-model-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;Model : Order&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="100" x="1050" y="30" as="geometry" />
        </mxCell>
        <mxCell id="db-box" parent="1" style="html=1;whiteSpace=wrap;" value="&lt;u&gt;DB : Database&lt;/u&gt;" vertex="1">
          <mxGeometry height="50" width="100" x="1210" y="30" as="geometry" />
        </mxCell>
        
        <!-- ========== PHASE 1: VIEW SHOP ========== -->
        <mxCell id="frame1" parent="1" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;fillColor=none;strokeColor=#666666;" value="Phase 1: Xem trang cửa hàng" vertex="1">
          <mxGeometry x="40" y="100" width="1300" height="300" as="geometry" />
        </mxCell>
        
        <!-- User opens shop -->
        <mxCell id="msg1" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="1 : clickShop($sellerId)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="115" y="140" as="sourcePoint" />
            <mxPoint x="255" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- View calls controller -->
        <mxCell id="msg2" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="2 : index(?id=$sellerId)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="265" y="165" as="sourcePoint" />
            <mxPoint x="435" y="165" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller activation -->
        <mxCell id="ctrl-act1" parent="1" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" value="" vertex="1">
          <mxGeometry height="190" width="10" x="435" y="165" as="geometry" />
        </mxCell>
        
        <!-- Controller gets seller info -->
        <mxCell id="msg3" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="3 : find($sellerId)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="445" y="195" as="sourcePoint" />
            <mxPoint x="615" y="195" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- User Model returns -->
        <mxCell id="msg4" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" value="4 : return $seller">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="615" y="215" as="sourcePoint" />
            <mxPoint x="445" y="215" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller gets products -->
        <mxCell id="msg5" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="5 : getByUserId($sellerId)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="445" y="240" as="sourcePoint" />
            <mxPoint x="775" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Product Model returns -->
        <mxCell id="msg6" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" value="6 : return $products[]">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="775" y="260" as="sourcePoint" />
            <mxPoint x="445" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller gets follow info -->
        <mxCell id="msg7" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="7 : getFollowerCount($sellerId) + isFollowing($currentUser, $sellerId)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="445" y="285" as="sourcePoint" />
            <mxPoint x="935" y="285" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Follow Model returns -->
        <mxCell id="msg8" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" value="8 : return $followerCount, $isFollowing">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="935" y="305" as="sourcePoint" />
            <mxPoint x="445" y="305" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller returns view -->
        <mxCell id="msg9" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="9 : view('shop/index', $seller, $products, $followerCount, $isFollowing, $isOwner)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="435" y="335" as="sourcePoint" />
            <mxPoint x="255" y="335" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- View displays -->
        <mxCell id="msg10" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="10 : displayShopPage(seller info, products grid, follow button)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="255" y="365" as="sourcePoint" />
            <mxPoint x="115" y="365" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- ========== PHASE 2: FOLLOW/UNFOLLOW ========== -->
        <mxCell id="frame2" parent="1" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;fillColor=none;strokeColor=#666666;" value="Phase 2: Theo dõi / Bỏ theo dõi shop (AJAX)" vertex="1">
          <mxGeometry x="40" y="420" width="1300" height="260" as="geometry" />
        </mxCell>
        
        <!-- User clicks follow -->
        <mxCell id="msg11" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="11 : clickFollowButton()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="115" y="460" as="sourcePoint" />
            <mxPoint x="255" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- View calls AJAX -->
        <mxCell id="msg12" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="12 : toggleFollow() [AJAX POST {shop_id}]">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="265" y="490" as="sourcePoint" />
            <mxPoint x="435" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller activation -->
        <mxCell id="ctrl-act2" parent="1" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" value="" vertex="1">
          <mxGeometry height="140" width="10" x="435" y="490" as="geometry" />
        </mxCell>
        
        <!-- Check following status -->
        <mxCell id="msg13" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="13 : isFollowing($currentUser, $shopId)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="445" y="520" as="sourcePoint" />
            <mxPoint x="935" y="520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Alt frame -->
        <mxCell id="alt-follow" parent="1" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;fillColor=none;strokeColor=#999999;dashed=1;" value="alt [isFollowing ? unfollow : follow]" vertex="1">
          <mxGeometry x="430" y="545" width="620" height="80" as="geometry" />
        </mxCell>
        
        <!-- Follow/Unfollow action -->
        <mxCell id="msg14" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="14 : follow() OR unfollow()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="445" y="575" as="sourcePoint" />
            <mxPoint x="935" y="575" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Follow inserts/deletes DB -->
        <mxCell id="msg15" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="15 : INSERT/DELETE follows">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="945" y="595" as="sourcePoint" />
            <mxPoint x="1255" y="595" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller returns JSON -->
        <mxCell id="msg16" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" value="16 : return JSON {success, status, new_count}">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="435" y="645" as="sourcePoint" />
            <mxPoint x="115" y="645" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- View updates UI -->
        <mxCell id="note-ui" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="&lt;span style=&quot;font-size: 11px; background-color: rgb(18, 18, 18);&quot;&gt;17 : updateButtonUI() + updateFollowerCount()&lt;/span&gt;" vertex="1">
          <mxGeometry height="30" width="200" x="120" y="660" as="geometry" />
        </mxCell>
        
        <!-- ========== PHASE 3: SELLER ORDERS ========== -->
        <mxCell id="frame3" parent="1" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;fillColor=none;strokeColor=#666666;" value="Phase 3: Xem đơn bán hàng (Seller)" vertex="1">
          <mxGeometry x="40" y="700" width="1300" height="260" as="geometry" />
        </mxCell>
        
        <!-- Seller clicks orders -->
        <mxCell id="msg17" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="18 : clickOrdersTab()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="115" y="740" as="sourcePoint" />
            <mxPoint x="255" y="740" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- View calls controller -->
        <mxCell id="msg18" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="19 : orders(?status=$filter)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="265" y="770" as="sourcePoint" />
            <mxPoint x="435" y="770" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller activation -->
        <mxCell id="ctrl-act3" parent="1" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" value="" vertex="1">
          <mxGeometry height="130" width="10" x="435" y="770" as="geometry" />
        </mxCell>
        
        <!-- Controller gets orders -->
        <mxCell id="msg19" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="20 : getBySellerId($userId)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="445" y="800" as="sourcePoint" />
            <mxPoint x="1095" y="800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Order Model returns -->
        <mxCell id="msg20" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" value="21 : return $orders[] (with items)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1095" y="820" as="sourcePoint" />
            <mxPoint x="445" y="820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Filter and count -->
        <mxCell id="note-filter" parent="1" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" value="&lt;span style=&quot;font-size: 11px; background-color: rgb(18, 18, 18);&quot;&gt;22 : filterByStatus() + countByStatus()&lt;/span&gt;" vertex="1">
          <mxGeometry height="30" width="180" x="450" y="840" as="geometry" />
        </mxCell>
        
        <!-- Controller returns view -->
        <mxCell id="msg21" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="23 : view('shop/orders', $orders, $counts)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="435" y="875" as="sourcePoint" />
            <mxPoint x="255" y="875" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- View displays -->
        <mxCell id="msg22" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="24 : displayOrderList(tabs: all, pending, shipping, completed...)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="255" y="905" as="sourcePoint" />
            <mxPoint x="115" y="905" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- ========== PHASE 4: UPDATE ORDER STATUS ========== -->
        <mxCell id="frame4" parent="1" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;fillColor=none;strokeColor=#666666;" value="Phase 4: Cập nhật trạng thái đơn hàng" vertex="1">
          <mxGeometry x="40" y="980" width="1300" height="180" as="geometry" />
        </mxCell>
        
        <!-- Seller clicks status -->
        <mxCell id="msg23" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="25 : clickUpdateStatus($orderId, $newStatus)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="115" y="1020" as="sourcePoint" />
            <mxPoint x="255" y="1020" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- View calls controller -->
        <mxCell id="msg24" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="26 : updateOrderStatus($_POST)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="265" y="1050" as="sourcePoint" />
            <mxPoint x="435" y="1050" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller activation -->
        <mxCell id="ctrl-act4" parent="1" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" value="" vertex="1">
          <mxGeometry height="70" width="10" x="435" y="1050" as="geometry" />
        </mxCell>
        
        <!-- Controller updates order -->
        <mxCell id="msg25" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="27 : updateStatus($orderId, $status)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="445" y="1080" as="sourcePoint" />
            <mxPoint x="1095" y="1080" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Order updates DB -->
        <mxCell id="msg26" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="28 : UPDATE orders SET status = ?">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="1105" y="1100" as="sourcePoint" />
            <mxPoint x="1255" y="1100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Controller redirects -->
        <mxCell id="msg27" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" value="29 : redirect('/shop/orders')">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="435" y="1130" as="sourcePoint" />
            <mxPoint x="115" y="1130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
